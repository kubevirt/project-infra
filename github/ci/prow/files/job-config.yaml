periodics:
- name: periodic-test-infra-close
  interval: 1h
  spec:
    nodeSelector:
      type: vm
    containers:
    - image: gcr.io/k8s-testimages/commenter:v20170808-abf66782
      args:
      - |-
        --query=org:kubevirt
        -label:lifecycle/frozen
        label:lifecycle/rotten
      - --updated=720h
      - --token=/etc/github/oauth
      - |-
        --comment=Rotten issues close after 30d of inactivity.
        Reopen the issue with `/reopen`.
        Mark the issue as fresh with `/remove-lifecycle rotten`.

        /close
      - --template
      - --ceiling=10
      - --confirm
      volumeMounts:
      - name: token
        mountPath: /etc/github
    volumes:
    - name: token
      secret:
        secretName: oauth-token

- name: periodic-test-infra-rotten
  interval: 1h
  spec:
    nodeSelector:
      type: vm
    containers:
    - image: gcr.io/k8s-testimages/commenter:v20170808-abf66782
      args:
      - |-
        --query=org:kubevirt
        -label:lifecycle/frozen
        label:lifecycle/stale
        -label:lifecycle/rotten
      - --updated=720h
      - --token=/etc/github/oauth
      - |-
        --comment=Stale issues rot after 30d of inactivity.
        Mark the issue as fresh with `/remove-lifecycle rotten`.
        Rotten issues close after an additional 30d of inactivity.

        If this issue is safe to close now please do so with `/close`.

        /lifecycle rotten
      - --template
      - --ceiling=10
      - --confirm
      volumeMounts:
      - name: token
        mountPath: /etc/github
    volumes:
    - name: token
      secret:
        secretName: oauth-token

- name: periodic-test-infra-stale
  interval: 1h
  spec:
    nodeSelector:
      type: vm
    containers:
    - image: gcr.io/k8s-testimages/commenter:v20170808-abf66782
      args:
      - |-
        --query=org:kubevirt
        -label:lifecycle/frozen
        -label:lifecycle/stale
        -label:lifecycle/rotten
      - --updated=2160h
      - --token=/etc/github/oauth
      - |-
        --comment=Issues go stale after 90d of inactivity.
        Mark the issue as fresh with `/remove-lifecycle stale`.
        Stale issues rot after an additional 30d of inactivity and eventually close.

        If this issue is safe to close now please do so with `/close`.

        /lifecycle stale
      - --template
      - --ceiling=10
      - --confirm
      volumeMounts:
      - name: token
        mountPath: /etc/github
    volumes:
    - name: token
      secret:
        secretName: oauth-token

presubmits:
  kubevirt/project-infra:
  - name: check-prow-config
    always_run: true
    decorate: true
    spec:
      nodeSelector:
        type: vm
      containers:
      - image: gcr.io/k8s-prow/checkconfig:v20190213-2748736
        args:
        - "/checkconfig"
        - "--config-path"
        - "github/ci/prow/files/config.yaml"
        - "--job-config-path"
        - "github/ci/prow/files/labels.yaml"
        - "--plugin-config"
        - "github/ci/prow/files/plugins.yaml"
        - "--strict"
        resources:
          requests:
            memory: "500Mi"

  kubevirt/kubevirtci:
  - name: check-provision-os-3.11.0-multus
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd os-3.11-multus && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-os-3.11.0
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd os-3.11 && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-os-3.11.0-crio
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd os-3.11-crio && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-k8s-1.10.11
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd k8s/1.10.11 && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-k8s-1.11.0
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd k8s/1.11.0 && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-k8s-multus-1.12.2
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd k8s-multus/1.12.2/ && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-k8s-multus-1.13.3
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd k8s-multus/1.13.3/ && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: check-provision-k8s-genie-1.11.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    spec:
    labels:
      preset-dind-enabled: "true"
    spec:
      nodeSelector:
        model: r430
        type: bare-metal
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190211-fab6034b4
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd k8s-genie/1.11.1/ && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"
