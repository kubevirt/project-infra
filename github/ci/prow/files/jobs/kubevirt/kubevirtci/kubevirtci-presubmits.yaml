presubmits:
  kubevirt/kubevirtci:
  - name: check-provision-os-3.11.0
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/os-3.11 && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-os-3.11.0
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/os-3.11 && ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-os-3.11.0-crio
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/os-3.11-crio && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-os-3.11.0-crio
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/os-3.11-crio && ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-os-3.11.0-multus
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/sh"
            - "-c"
            - "cd cluster-provision/os-3.11-multus && ./provision.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: push-os-3.11.0-multus
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/os-3.11-multus && ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-okd-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/okd/4.1 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: push-okd-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/okd/4.1 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-up-okd-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "KUBEVIRT_PROVIDER=okd-4.1 make cluster-up"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: check-up-kind-k8s-1.17.0-ipv6
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "KUBEVIRT_PROVIDER=kind-k8s-1.17.0-ipv6 make cluster-up"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"
        volumeMounts:
          #for running kind with dind (see https://github.com/kubernetes-sigs/kind/issues/303)
          - name: modules
            mountPath: /lib/modules
            readOnly: true
          - name: cgroup
            mountPath: /sys/fs/cgroup
      volumes:
        - name: modules
          hostPath:
            path: /lib/modules
            type: Directory
        - name: cgroup
          hostPath:
            path: /sys/fs/cgroup
            type: Directory

  - name: check-up-kind-k8s-1.14.2
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "KUBEVIRT_PROVIDER=kind-k8s-1.14.2 make cluster-up"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: check-up-kind-1.17-sriov
    annotations:
      k8s.v1.cni.cncf.io/networks: multus-cni-ns/sriov-passthrough-cni
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 1h
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
      sriov-pod: "true"
    spec:
      nodeSelector:
        hardwareSupport: sriov-nic
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: sriov-pod
                    operator: In
                    values:
                      - "true"
              topologyKey: kubernetes.io/hostname
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - >
            apt update &&
            apt install gettext-base -y &&
            wget https://dl.google.com/go/go1.13.8.linux-amd64.tar.gz &&
            tar -xzf go1.13.8.linux-amd64.tar.gz -C /usr/local/ &&
            export PATH=/usr/local/go/bin:$PATH &&
            export KUBEVIRT_PROVIDER=kind-k8s-sriov-1.17.0 &&
            export KUBEVIRT_NUM_NODES=2 &&
            make cluster-up
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"
        volumeMounts:
          #for running kind with dind (see https://github.com/kubernetes-sigs/kind/issues/303)
          - name: modules
            mountPath: /lib/modules
            readOnly: true
          - name: cgroup
            mountPath: /sys/fs/cgroup
          - name: vfio
            mountPath: /dev/vfio/
      volumes:
        - name: modules
          hostPath:
            path: /lib/modules
            type: Directory
        - name: cgroup
          hostPath:
            path: /sys/fs/cgroup
            type: Directory
        - name: vfio
          hostPath:
            path: /dev/vfio/
            type: Directory

  - name: check-provision-okd-network-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/sh"
            - "-c"
            - "cd cluster-provision/okd/network-4.1 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: push-okd-network-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/okd/network-4.1 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-up-okd-network-4.1
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "KUBEVIRT_PROVIDER=okd-network-4.1 make cluster-up"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"


  - name: check-provision-okd-4.2
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/okd/4.2 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: push-okd-4.2
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/okd/4.2 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-up-okd-4.2
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "KUBEVIRT_PROVIDER=okd-4.2 make cluster-up"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: check-provision-ocp-4.3
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp/4.3 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "30Gi"

  - name: push-ocp-4.3
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp/4.3 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "30Gi"

  - name: check-up-ocp-4.3
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && KUBEVIRT_PROVIDER=ocp-4.3 make cluster-up"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-provision-ocp-4.4
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp/4.4 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "30Gi"

  - name: push-ocp-4.4
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp/4.4 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "30Gi"

  - name: check-up-ocp-4.4
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && KUBEVIRT_PROVIDER=ocp-4.4 make cluster-up"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-provision-ocp-cnao-4.4
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp-cnao/4.4 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "30Gi"

  - name: push-ocp-cnao-4.4
    always_run: false
    optional: true
    decorate: true
    decoration_config:
      timeout: 4h
      grace_period: 5m

    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && cd cluster-provision/ocp-cnao/4.4 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "30Gi"

  - name: check-up-ocp-cnao-4.4
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-quay-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $QUAY_PASSWORD | docker login --username $(cat $QUAY_USER) --password-stdin=true quay.io && KUBEVIRT_PROVIDER=ocp-cnao-4.4 make cluster-up"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-provision-okd-4.3
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/okd/4.3 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "15Gi"

  - name: push-okd-4.3
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
      preset-kubevirtci-installer-pull-token: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/okd/4.3 && INSTALLER_PULL_SECRET=$INSTALLER_PULL_SECRET ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "15Gi"

  - name: check-provision-k8s-1.15
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s/1.15 && ../provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-1.15
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s/1.15/ && ../provision.sh && ../publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-k8s-fedora-1.17.0
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s-fedora/1.17.0 && ./provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-fedora-1.17.0
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s-fedora/1.17.0/ && ./provision.sh && ./publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"


  - name: check-provision-k8s-1.18
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s/1.18 && ../provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-1.18
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s/1.18/ && ../provision.sh && ../publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-k8s-1.17
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s/1.17 && ../provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-1.17
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s/1.17/ && ../provision.sh && ../publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-k8s-1.16
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s/1.16 && ../provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-1.16
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s/1.16/ && ../provision.sh && ../publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-provision-k8s-1.14
    run_if_changed: "cluster-provision/k8s/.*"
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-c"
        - "cd cluster-provision/k8s/1.14 && ../provision.sh"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "8Gi"

  - name: push-k8s-1.14
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/bootstrap:v20190516-c6832d9
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/k8s/1.14/ && ../provision.sh && ../publish.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "8Gi"

  - name: check-gocli
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cd cluster-provision/gocli/ && make all container"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: push-gocli
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/bash"
        - "-c"
        - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/gocli/ && make all push"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "1Gi"

  - name: check-base
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cd cluster-provision/base/ && ./build.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: push-base
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/base/ && ./build.sh && ./publish.sh "
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: check-centos7
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cd cluster-provision/centos7/ && ./build.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: push-centos7
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/centos7/ && ./build.sh && ./publish.sh "
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: check-centos8
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cd cluster-provision/centos8/ && ./build.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: push-centos8
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/centos8/ && ./build.sh && ./publish.sh "
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"


  - name: check-fedora
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cd cluster-provision/fedora/ && ./build.sh"
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"

  - name: push-fedora
    always_run: false
    optional: true
    decorate: true
    max_concurrency: 1
    labels:
      preset-dind-enabled: "true"
      preset-docker-mirror: "true"
      preset-kubevirtci-docker-credential: "true"
    spec:
      nodeSelector:
        type: bare-metal-external
      containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e@sha256:8c80c98d035a0f285ad49b964e5d0b62004844f3340407367841618e80e1503c
          command:
            - "/usr/local/bin/runner.sh"
            - "/bin/bash"
            - "-c"
            - "cat $DOCKER_PASSWORD | docker login --username $(<$DOCKER_USER) --password-stdin && cd cluster-provision/fedora/ && ./build.sh && ./publish.sh "
          # docker-in-docker needs privileged mode
          securityContext:
            privileged: true
          resources:
            requests:
              memory: "1Gi"
