presubmits:
  kubevirt/community:
  - always_run: true
    cluster: kubevirt-prow-control-plane
    decorate: true
    extra_refs:
    - org: kubevirt
      repo: project-infra
      base_ref: main
    name: pull-community-make-generate
    spec:
      containers:
      - args:
        - |
          make generate
          git diff --exit-code || (
            echo "ERROR: Unapplied changes detected - please run make generate and commit changes!" && exit 1
          )
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-ce"
        image: quay.io/kubevirtci/golang:v20251015-5720d72
        resources:
          requests:
            memory: "1Gi"
          limits:
            memory: "1Gi"
  - always_run: false
    cluster: kubevirt-prow-control-plane
    decorate: true
    extra_refs:
    - org: kubevirt
      repo: project-infra
      base_ref: main
    name: pull-community-make-lint
    run_if_changed: "generators/.*|validators/.*|pkg/.*"
    spec:
      containers:
      - args:
        - |
          curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b ${GOPATH}/bin ${GOLANGCI_LINT_VERSION}
          make lint
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-ce"
        env:
        - name: GOLANGCI_LINT_VERSION
          value: "v2.4.0"
        image: quay.io/kubevirtci/golang:v20251015-5720d72
        resources:
          requests:
            memory: "1Gi"
          limits:
            memory: "1Gi"
  - always_run: false
    cluster: kubevirt-prow-control-plane
    decorate: true
    extra_refs:
    - org: kubevirt
      repo: project-infra
      base_ref: main
    name: pull-community-make-test
    run_if_changed: "generators/.*|validators/.*|pkg/.*"
    spec:
      containers:
      - args:
        - make test
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-ce"
        image: quay.io/kubevirtci/golang:v20251015-5720d72
        resources:
          requests:
            memory: "1Gi"
          limits:
            memory: "1Gi"
  - always_run: false
    cluster: kubevirt-prow-control-plane
    decorate: true
    extra_refs:
    - org: kubevirt
      repo: project-infra
      base_ref: main
    name: pull-community-make-coverage
    run_if_changed: "generators/.*|validators/.*|pkg/.*"
    spec:
      containers:
      - args:
        - |
          go install github.com/cancue/covreport@latest
          make coverage
        command:
        - "/usr/local/bin/runner.sh"
        - "/bin/sh"
        - "-ce"
        image: quay.io/kubevirtci/golang:v20251015-5720d72
        resources:
          requests:
            memory: "1Gi"
          limits:
            memory: "1Gi"
