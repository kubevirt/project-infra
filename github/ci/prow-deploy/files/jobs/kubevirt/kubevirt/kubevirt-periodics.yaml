periodics:
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 5 * * * *
  decorate: true
  labels:
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
  name: periodic-kubevirt-flakefinder-hourly-rolling-window-report
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - --dry-run=false
      - --token=/etc/github/oauth
      - --merged=24h
      - --today=true
      - --report_output_child_path=kubevirt/kubevirt
      - --skip_results_before_start_of_report=false
      - --pr_base_branch=main
      command:
      - /usr/bin/flakefinder
      image: quay.io/kubevirtci/flakefinder:v20250103-a6934c9
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 0 * * *
  decorate: true
  labels:
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
  name: periodic-publish-kubevirt-flakefinder-weekly-report
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - --dry-run=false
      - --token=/etc/github/oauth
      - --merged=168h
      - --report_output_child_path=kubevirt/kubevirt
      - --skip_results_before_start_of_report=false
      - --periodic_job_dir_regex=periodic-kubevirt-e2e-.*
      - --pr_base_branch=main
      command:
      - /usr/bin/flakefinder
      image: quay.io/kubevirtci/flakefinder:v20250103-a6934c9
      name: ""
      resources:
        requests:
          cpu: 500m
          memory: 8Gi
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 25 0 * * *
  decorate: true
  labels:
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
  name: periodic-publish-kubevirt-flakefinder-daily-report
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - --dry-run=false
      - --token=/etc/github/oauth
      - --merged=24h
      - --report_output_child_path=kubevirt/kubevirt
      - --skip_results_before_start_of_report=false
      - --periodic_job_dir_regex=periodic-kubevirt-e2e-.*
      - --pr_base_branch=main
      command:
      - /usr/bin/flakefinder
      image: quay.io/kubevirtci/flakefinder:v20250103-a6934c9
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 25 1 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  name: periodic-push-kubevirt-flakefinder-report-values
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - |
        go run robots/cmd/push-flakefinder-results/main.go --pushgateway-url=http://pushgateway.kubevirt-prow
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 30 3 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-gcs-credentials: "true"
  name: periodic-report-merge-commit-summary
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - |
        dnf config-manager addrepo --from-repofile=https://cli.github.com/packages/rpm/gh-cli.repo
        dnf install -y gh --repo gh-cli

        report_dir="/tmp/merge-commit-summary"
        mkdir -p "${report_dir}"
        go run ./robots/cmd/merge-commit-summary \
          --days-in-the-past 7 \
          --output-file "${report_dir}/index.html"
        gsutil cp "${report_dir}/*" "gs://kubevirt-prow/reports/merge-commit-summary/kubevirt/kubevirt/last-seven-days/"
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      - name: GITHUB_TOKEN
        valueFrom:
          secretKeyRef:
            key: oauth
            name: oauth-token
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 3 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-gcs-credentials: "true"
  name: periodic-push-per-test-execution-results-six-months
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - |
        report_dir="/tmp/per-test-results/last-six-months"
        mkdir -p "${report_dir}"
        go run ./robots/cmd/per-test-execution --months 6 --output-directory "${report_dir}"
        gsutil cp "${report_dir}/*" "gs://kubevirt-prow/reports/per-test-results/kubevirt/kubevirt/last-six-months/"
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 3 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-gcs-credentials: "true"
  name: periodic-publish-kubevirt-most-flaky-tests-report
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - |
        go run ./robots/cmd/quarantine report --output-file "/tmp/index.html"
        gsutil cp "/tmp/index.html" "gs://kubevirt-prow/reports/most-flaky-tests/kubevirt/kubevirt/"
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIMME_GO_VERSION
        value: 1.23.4
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 25 1 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-gcs-credentials: "true"
  name: periodic-kubevirt-push-test-metrics
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - args:
      - |
        go run robots/cmd/push-test-metrics/main.go \
          --pushgateway-url=http://pushgateway.kubevirt-prow
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-alert-email: bodnopoz@redhat.com, kubevirtci-sysprep-test@googlegroups.com
    testgrid-alert-stale-results-hours: "1"
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
    testgrid-num-failures-to-alert: "1"
  cluster: prow-workloads
  cron: 0 0 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-docker-mirror-proxy: "true"
    preset-gcs-credentials: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-sysprep
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: TARGET
        value: windows_sysprep
      - name: KUBEVIRT_WINDOWS_PRODUCT_KEY_PATH
        value: /etc/win-sysprep/productKey
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /etc/win-sysprep
        name: win-sysprep
    nodeSelector:
      type: bare-metal-external
    volumes:
    - name: win-sysprep
      secret:
        secretName: win-sysprep-001
- annotations:
    testgrid-create-test-group: "false"
  cluster: prow-workloads
  cron: 2 1 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 1h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  - base_ref: main
    org: kubevirt
    repo: kubevirt
    workdir: true
  labels:
    preset-docker-mirror-proxy: "true"
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
    preset-kubevirtci-quay-credential: "true"
    preset-podman-in-container-enabled: "true"
    preset-shared-images: "true"
  max_concurrency: 1
  name: periodic-kubevirt-push-nightly-build-main
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        set -e
        build_date="$(date +%Y%m%d)"
        cat "$QUAY_PASSWORD" | podman login --username $(cat "$QUAY_USER") --password-stdin=true quay.io
        export DOCKER_TAG="${build_date}_$(git show -s --format=%h)"
        make
        counter=3
        retval=0
        while [ $counter -gt 0 ]; do
            set +e
            make push
            retval=$?
            set -e
            if [ $retval -eq 0 ]; then
                break
            fi
            set +e
            counter=$(expr $counter - 1)
            set -e
            sleep 120
        done
        if [ $retval -ne 0 ]; then
            echo "push failed!"
            exit 1
        fi
        make build-functests
        git show -s --format=%H > _out/commit
        echo ${build_date} > _out/build_date
        bucket_dir="kubevirt-prow/devel/nightly/release/kubevirt/kubevirt/${build_date}"
        gsutil cp ./_out/manifests/release/kubevirt-operator.yaml ./_out/manifests/release/kubevirt-cr.yaml _out/manifests/release/conformance.yaml gs://$bucket_dir/
        gsutil cp -r ./_out/manifests/testing gs://$bucket_dir/
        gsutil cp ./_out/tests/tests.test gs://$bucket_dir/testing/
        gsutil cp ./_out/cmd/dump/dump gs://$bucket_dir/testing/dump
        gsutil cp ./_out/commit gs://$bucket_dir/commit
        gsutil cp ./_out/build_date gs://kubevirt-prow/devel/nightly/release/kubevirt/kubevirt/latest
        unset DOCKER_TAG # we want to publish to main
        export PULL_BASE_REF=main
        export GIT_ASKPASS="$(pwd)/automation/git-askpass.sh"
        hack/publish-staging.sh
      env:
      - name: DOCKER_PREFIX
        value: quay.io/kubevirt
      - name: GIT_USER_NAME
        value: kubevirt-bot
      - name: GITHUB_TOKEN_PATH
        value: /etc/github/oauth
      - name: BUILD_ARCH
        value: amd64,crossbuild-s390x,crossbuild-aarch64
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 2 15 */7 * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 1h0m0s
  labels:
    preset-docker-mirror-proxy: "true"
    preset-gcs-credentials: "true"
    preset-shared-images: "true"
  max_concurrency: 1
  name: periodic-kubevirt-clean-nightly-build
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        set -e; latest_build=$(gsutil cat gs://kubevirt-prow/devel/nightly/release/kubevirt/kubevirt/latest); delete_before_seconds=$(date -d "$latest_build - 4 weeks" +%s); for nightly_build_dir in $(gsutil ls gs://kubevirt-prow/devel/nightly/release/kubevirt/kubevirt/ | grep -E '[0-9]+\/$'); do
          build_date=$(echo "${nightly_build_dir}" | sed -E 's#^.*/([0-9]+)/$#\1#g');
          bd_seconds=$(date -d "$build_date" +%s);
          if [ $bd_seconds -lt $delete_before_seconds ]; then
            echo "Deleting $nightly_build_dir";
            gsutil -m rm -r ${nightly_build_dir};
          fi;
        done
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 200Mi
- annotations:
    testgrid-dashboards: kubevirt-periodics
  cluster: prow-workloads
  cron: 30 2 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 7h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    path_alias: kubevirt
    repo: kubevirt
    workdir: true
  labels:
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-shared-images: "true"
  max_concurrency: 1
  name: periodic-kubevirt-push-nightly-conformance
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/conformance.sh
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
  cluster: prow-workloads
  cron: 0 22, 10 * * *
  decorate: true
  decoration_config:
    grace_period: 30m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    vgpu: "true"
  max_concurrency: 1
  name: periodic-kubevirt-e2e-kind-1.33-vgpu
  spec:
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: vgpu
              operator: In
              values:
              - "true"
          topologyKey: kubernetes.io/hostname
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      - |
        automation/test.sh
      env:
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: kind-1.33-vgpu
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 18Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /sys/fs/cgroup
        name: cgroup
      - mountPath: /dev/vfio/
        name: vfio
    nodeSelector:
      hardwareSupport: gpu
    priorityClassName: vgpu
    volumes:
    - hostPath:
        path: /sys/fs/cgroup
        type: Directory
      name: cgroup
    - hostPath:
        path: /dev/vfio
        type: Directory
      name: vfio
- annotations:
    k8s.v1.cni.cncf.io/networks: default/sriov-passthrough-cni,default/sriov-passthrough-cni
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 23 * * 6
  decorate: true
  decoration_config:
    grace_period: 30m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-kind-sriov
  spec:
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: sriov-pod
              operator: In
              values:
              - "true"
          topologyKey: kubernetes.io/hostname
        - labelSelector:
            matchExpressions:
            - key: sriov-pod-multi
              operator: In
              values:
              - "true"
          topologyKey: kubernetes.io/hostname
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      - automation/test.sh
      env:
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: kind-sriov
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /sys/fs/cgroup
        name: cgroup
      - mountPath: /dev/vfio/
        name: vfio
    nodeSelector:
      hardwareSupport: sriov-nic
    priorityClassName: sriov
    volumes:
    - hostPath:
        path: /sys/fs/cgroup
        type: Directory
      name: cgroup
    - hostPath:
        path: /dev/vfio/
        type: Directory
      name: vfio
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 15 22 * * 0
  decorate: true
  decoration_config:
    timeout: 1h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror: "true"
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
    preset-podman-in-container-enabled: "true"
  max_concurrency: 1
  name: bump-kubevirt-rpms-weekly
  reporter_config:
    slack:
      report: true
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -c
      - ../project-infra/hack/git-pr.sh -c "cd ../kubevirt && make rpm-deps" -b bump-rpm-dependencies
        -p ../kubevirt -T main -R -L skip-review -B $'Run of `cd ../kubevirt && make
        rpm-deps`\n\n/release-blocker main'
      image: quay.io/kubevirtci/pr-creator:v20251125-430e226
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-arm64-workloads
  cron: 40 4,12,20 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-podman-in-container-enabled: "true"
  max_concurrency: 5
  name: periodic-kubevirt-kind-e2e-test-ARM64
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -ce
      - automation/test.sh
      env:
      - name: TARGET
        value: kind-1.34-wg-arm64
      - name: KUBEVIRT_NUM_NODES
        value: "2"
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /sys/fs/cgroup
        name: cgroup
    volumes:
    - hostPath:
        path: /sys/fs/cgroup
        type: Directory
      name: cgroup
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-arm64-workloads
  cron: 40 4,12,20 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-podman-in-container-enabled: "true"
  max_concurrency: 1
  name: periodic-kubevirt-kind-conformance-test-ARM64
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -ce
      - |
        automation/conformance.sh
      env:
      - name: TARGET
        value: kind-1.34
      - name: KUBEVIRT_PROVIDER
        value: kind-1.34
      - name: KUBEVIRT_NUM_NODES
        value: "3"
      - name: IPFAMILY
        value: dual
      - name: RUN_ON_ARM64_INFRA
        value: "true"
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /sys/fs/cgroup
        name: cgroup
    volumes:
    - hostPath:
        path: /sys/fs/cgroup
        type: Directory
      name: cgroup
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 30 4,12,20,00 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-quay-credential: "true"
    preset-podman-in-container-enabled: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-test-S390X
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # install yq
        curl -Lo ./yq https://github.com/mikefarah/yq/releases/download/3.4.1/yq_linux_amd64
        chmod +x ./yq && mv ./yq /usr/local/bin/yq

        # get kubectl
        curl -Lo ./kubectl "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x ./kubectl && mv ./kubectl /usr/local/bin/kubectl

        # get kubeconfig
        source ../project-infra/hack/manage-secrets.sh
        decrypt_secrets
        extract_secret 'kubeconfigS390x' /kubeconfig

        # login quay.io
        cat "$QUAY_PASSWORD" | docker login --username $(cat "$QUAY_USER") --password-stdin=true quay.io

        # run the test
        automation/test.sh
      env:
      - name: TARGET
        value: external-wg-s390x
      - name: KUBEVIRT_PROVIDER
        value: external
      - name: DOCKER_PREFIX
        value: quay.io/kubevirtci
      - name: DOCKER_TAG
        value: s390x_test
      - name: KUBECONFIG
        value: /kubeconfig
      - name: IMAGE_PULL_POLICY
        value: Always
      - name: BUILD_ARCH
        value: crossbuild-s390x
      - name: GIT_ASKPASS
        value: ../project-infra/hack/git-askpass.sh
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /etc/github
        name: token
      - mountPath: /etc/pgp
        name: pgp-bot-key
        readOnly: true
    nodeSelector:
      type: bare-metal-external
    volumes:
    - name: token
      secret:
        secretName: oauth-token
    - name: pgp-bot-key
      secret:
        secretName: pgp-bot-key
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-arm64-workloads
  cron: 40 4 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 2h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-unnested: "false"
  max_concurrency: 10
  name: periodic-kubevirt-unit-test-Arm64
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - make test
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-s390x-workloads
  cron: 40 5 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 2h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  max_concurrency: 10
  name: periodic-kubevirt-unit-test-s390x
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - make go-test
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: kubevirt-prow-control-plane
  cron: 40 4 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-bazel-cache: "true"
    preset-github-credentials: "true"
    preset-kubevirtci-quay-credential: "true"
    preset-pgp-bot-key: "true"
  max_concurrency: 1
  name: periodic-kubevirt-performance-cluster-100-density-test
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # install yq
        curl -Lo ./yq https://github.com/mikefarah/yq/releases/download/3.4.1/yq_linux_amd64
        chmod +x ./yq && mv ./yq /usr/local/bin/yq

        # get kubectl
        curl -L "https://dl.k8s.io/release/v1.19.7/bin/linux/amd64/kubectl" -o /usr/local/bin/kubectl
        chmod +x /usr/local/bin/kubectl

        # get kubeconfig
        source ../project-infra/hack/manage-secrets.sh
        decrypt_secrets
        extract_secret 'kubeconfigPerf' /kubeconfig

        # login quay.io
        cat "$QUAY_PASSWORD" | podman login --username $(cat "$QUAY_USER") --password-stdin=true quay.io

        # run test
        ./automation/perfscale-test.sh
      env:
      - name: TARGET
        value: external
      - name: KUBEVIRT_PROVIDER
        value: external
      - name: DOCKER_PREFIX
        value: quay.io/kubevirtci
      - name: DOCKER_TAG
        value: perfscale_test
      - name: KUBECONFIG
        value: /kubeconfig
      - name: PROMETHEUS_PORT
        value: "9090"
      - name: PERFAUDIT
        value: "true"
      - name: kubectl
        value: /usr/local/bin/kubectl
      - name: IMAGE_PULL_POLICY
        value: Always
      - name: PERFSCALE_WORKLOAD
        value: tools/perfscale-load-generator/examples/workload/kubevirt-density/kubevirt-burst-100.yaml
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 4Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: kubevirt-prow-control-plane
  cron: 40 15 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-bazel-cache: "true"
    preset-github-credentials: "true"
    preset-kubevirtci-quay-credential: "true"
    preset-pgp-bot-key: "true"
  max_concurrency: 1
  name: periodic-kubevirt-performance-cluster-scale-density-test
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # install yq
        curl -Lo ./yq https://github.com/mikefarah/yq/releases/download/3.4.1/yq_linux_amd64
        chmod +x ./yq && mv ./yq /usr/local/bin/yq

        # get kubectl
        curl -L "https://dl.k8s.io/release/v1.19.7/bin/linux/amd64/kubectl" -o /usr/local/bin/kubectl
        chmod +x /usr/local/bin/kubectl

        # get kubeconfig
        source ../project-infra/hack/manage-secrets.sh
        decrypt_secrets
        extract_secret 'kubeconfigPerf' /kubeconfig

        # login quay.io
        cat "$QUAY_PASSWORD" | podman login --username $(cat "$QUAY_USER") --password-stdin=true quay.io

        # run test 200
        PERFSCALE_WORKLOAD=$PERFSCALE_WORKLOAD_TWO_HUNDRED ./automation/perfscale-test.sh
        sleep 10m

        # run test 400
        PERFSCALE_WORKLOAD=$PERFSCALE_WORKLOAD_FOUR_HUNDRED ./automation/perfscale-test.sh
        sleep 10m

        # run test 600
        PERFSCALE_WORKLOAD=$PERFSCALE_WORKLOAD_SIX_HUNDRED ./automation/perfscale-test.sh
        sleep 30s
      env:
      - name: TARGET
        value: external
      - name: KUBEVIRT_PROVIDER
        value: external
      - name: DOCKER_PREFIX
        value: quay.io/kubevirtci
      - name: DOCKER_TAG
        value: perfscale_test
      - name: KUBECONFIG
        value: /kubeconfig
      - name: PROMETHEUS_PORT
        value: "9090"
      - name: kubectl
        value: /usr/local/bin/kubectl
      - name: IMAGE_PULL_POLICY
        value: Always
      - name: PERFSCALE_WORKLOAD_TWO_HUNDRED
        value: tools/perfscale-load-generator/examples/workload/kubevirt-density/kubevirt-burst-200.yaml
      - name: PERFSCALE_WORKLOAD_FOUR_HUNDRED
        value: tools/perfscale-load-generator/examples/workload/kubevirt-density/kubevirt-burst-400.yaml
      - name: PERFSCALE_WORKLOAD_SIX_HUNDRED
        value: tools/perfscale-load-generator/examples/workload/kubevirt-density/kubevirt-burst-600.yaml
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 4Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 40 7,15,23 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 6h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    ci.kubevirt.io/prometheus: ""
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-performance
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # Build the perfscale-audit binary
        make bazel-build

        # Create k8s cluster
        make cluster-up

        # Push and deploy kubevirt
        make cluster-sync

        FUNC_TEST_ARGS="--no-color --seed=42" make perftest
      env:
      - name: KUBEVIRT_PROVIDER
        value: k8s-1.34
      - name: KUBEVIRT_STORAGE
        value: hpp
      - name: KUBEVIRT_MEMORY_SIZE
        value: 16G
      - name: KUBEVIRT_NUM_NODES
        value: "4"
      - name: KUBEVIRT_DEPLOY_PROMETHEUS
        value: "true"
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --prometheus-port 30007
      - name: KUBEVIRT_WITH_ETC_CAPACITY
        value: 1G
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        limits:
          cpu: "24"
          memory: 73Gi
        requests:
          cpu: "24"
          memory: 73Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 2,10,18 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    ci.kubevirt.io/prometheus: ""
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-performance-kwok
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # Build the perfscale-audit binary
        make bazel-build

        # Create k8s cluster
        make cluster-up

        # Push and deploy kubevirt
        make cluster-sync

        FUNC_TEST_ARGS="--no-color --seed=42" make kwok-perftest
      env:
      - name: KUBEVIRT_PROVIDER
        value: k8s-1.34
      - name: KUBEVIRT_MEMORY_SIZE
        value: 35G
      - name: KUBEVIRT_DEPLOY_KWOK
        value: "true"
      - name: KUBEVIRT_DEPLOY_PROMETHEUS
        value: "true"
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --prometheus-port 30007
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          cpu: "12"
          memory: 73Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 4,12,20 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    ci.kubevirt.io/prometheus: ""
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-performance-kwok-100
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # Build the perfscale-audit binary
        make bazel-build

        # Create k8s cluster
        make cluster-up

        # Push and deploy kubevirt
        make cluster-sync

        FUNC_TEST_ARGS="--no-color --seed=42" make kwok-perftest
      env:
      - name: KUBEVIRT_PROVIDER
        value: k8s-1.34
      - name: KUBEVIRT_MEMORY_SIZE
        value: 10G
      - name: KUBEVIRT_DEPLOY_KWOK
        value: "true"
      - name: KUBEVIRT_DEPLOY_PROMETHEUS
        value: "true"
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --prometheus-port 30007
      - name: VM_COUNT
        value: "100"
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          cpu: "12"
          memory: 73Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 6 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 1h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    ci.kubevirt.io/prometheus: ""
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.32-sig-performance-realtime
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # Create k8s cluster
        make cluster-up

        # Push and deploy kubevirt
        make cluster-sync

        FUNC_TEST_ARGS="--no-color --seed=42" make realtime-perftest
      env:
      - name: KUBEVIRT_PROVIDER
        value: k8s-1.32
      - name: KUBEVIRT_STORAGE
        value: rook-ceph-default
      - name: KUBEVIRT_MEMORY_SIZE
        value: 9G
      - name: KUBEVIRT_NUM_NODES
        value: "2"
      - name: KUBEVIRT_E2E_REALTIME_PERF_TEST
        value: "true"
      - name: KUBEVIRT_E2E_CYCLIC_DURATION_IN_SECONDS
        value: "60"
      - name: KUBEVIRT_E2E_REALTIME_LATENCY_THRESHOLD_IN_MICROSECONDS
        value: "40"
      - name: KUBEVIRT_HUGEPAGES_2M
        value: "512"
      - name: KUBEVIRT_REALTIME_SCHEDULER
        value: "true"
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          cpu: "10"
          memory: 26Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 3,7,15,23 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-compute-migrations
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-compute-migrations
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: amd-workloads
  cron: 20 5,13,21 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-podman-in-container-enabled: "true"
  name: periodic-kubevirt-e2e-kind-1.34-sev
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: kind-1.34-sev
      - name: KUBEVIRT_PROVIDER
        value: kind-1.34
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 18Gi
      securityContext:
        privileged: true
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 5 * * 0
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-network-with-dnc
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # make the test suite run the hotplug NICs tests.
        export KUBEVIRT_WITH_DYN_NET_CTRL=true
        automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-network
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 2,18 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-storage-root
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-storage
      - name: FEATURE_GATES
        value: Root
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 20 3,19 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-compute-root
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-compute
      - name: FEATURE_GATES
        value: Root
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --usb 30M --usb 40M
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 30 6,22 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-operator-root
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-operator
      - name: FEATURE_GATES
        value: Root
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 5 7 * * 6
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 1h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
    workdir: true
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-bazel-unnested: "true"
    preset-gcs-credentials: "true"
    preset-github-credentials: "true"
  max_concurrency: 1
  name: periodic-kubevirt-image-bump
  spec:
    containers:
    - args:
      - |
        make bump-images
        git-pr.sh -c "cd ../project-infra && go run ./robots/cmd/uploader -workspace ${PWD}/../kubevirt/WORKSPACE -dry-run=false" -p ${PWD} -s 'Automated run of make bump-images and ./robots/cmd/uploader' -b bump-images -r kubevirt -L release-note-none -T main
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      image: quay.io/kubevirtci/pr-creator:v20251125-430e226
      name: ""
      resources:
        requests:
          memory: 200Mi
    securityContext:
      runAsUser: 0
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 6 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
    workdir: true
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-gcs-credentials: "true"
  name: periodic-kubevirt-quarantined-tests-daily-report
  spec:
    containers:
    - args:
      - stats
      - --output-html=true
      - --config-name=quarantine
      - --test-file-path=/home/prow/go/src/github.com/kubevirt/kubevirt/tests
      - --remote-url=https://github.com/kubevirt/kubevirt/tree/%s/tests
      - --output-gcs-url=gs://kubevirt-prow/reports/quarantined-tests/kubevirt/kubevirt/index.html
      command:
      - /usr/bin/test-label-analyzer
      image: quay.io/kubevirtci/test-label-analyzer:v20251125-430e226
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 7 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
    workdir: true
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-gcs-credentials: "true"
  name: periodic-kubevirt-quarantined-tests-daily-report-json
  spec:
    containers:
    - args:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      - |
        go run ./robots/cmd/test-label-analyzer stats --config-name=quarantine --test-file-path=/home/prow/go/src/github.com/kubevirt/kubevirt/tests --remote-url=https://github.com/kubevirt/kubevirt/%s/tests > /tmp/quarantine.json
        gsutil cp /tmp/quarantine.json gs://kubevirt-prow/reports/quarantined-tests/kubevirt/kubevirt/quarantine.json
      command:
      - /bin/sh
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 1 * * *
  decorate: true
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
    workdir: true
  labels:
    preset-gcs-credentials: "true"
  name: periodic-kubevirt-flake-stats-daily-report
  spec:
    containers:
    - args:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      - |
        # generate flake stats daily report for today
        output_file=/tmp/flake-stats-14days-$(date +%Y-%m-%d).html
        go run ./robots/cmd/flake-stats \
          '--filter-lane-regex=.*-root$' \
          --output-file ${output_file} \
          --overwrite-output-file=true
        gsutil cp ${output_file} gs://kubevirt-prow/reports/flakefinder/kubevirt/kubevirt/

        # generate index page with calendar
        index_output_file=/tmp/flake-stats-14days.html
        go run ./robots/cmd/flake-stats-index-page \
          --output-file-path ${index_output_file}
        gsutil cp ${index_output_file} gs://kubevirt-prow/reports/flakefinder/kubevirt/kubevirt/
      command:
      - /bin/sh
      env:
      - name: GIMME_GO_VERSION
        value: 1.25.1
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources: {}
- annotations:
    testgrid-create-test-group: "false"
  cluster: kubevirt-prow-control-plane
  cron: 45 1 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 1h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: project-infra
    workdir: true
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-github-credentials: "true"
  name: periodic-kubevirt-update-upcoming-changes
  spec:
    containers:
    - args:
      - |
        set -x
        project_infra_dir=$(cd ../project-infra && pwd)
        kubevirt_dir=$(cd ../kubevirt && pwd)
        (
          cd ..
          git clone ${GIT_REPO_URL}
          cd sig-release
          git config user.email "$GIT_AUTHOR_EMAIL"
          git config user.name "$GIT_AUTHOR_NAME"
        )
        sig_release_dir=$(cd ../sig-release && pwd)
        cd ${project_infra_dir}
        go run ./releng/feature-announce \
            --log-level=5 \
            --output-file=${sig_release_dir}/upcoming-changes.md \
            --org kubevirt \
            --repo kubevirt \
            --path-to-repository $kubevirt_dir \
            --github-token-file /etc/github/oauth
        cd ${sig_release_dir}
        git add upcoming-changes.md
        if git diff --name-only --exit-code HEAD; then
          echo "Nothing changed" >&2
          exit 0
        fi
        git commit --signoff -m "robot ./releng/feature-announce: update list of notable changes for next KubeVirt release"
        git push ${GIT_REPO_URL} HEAD:main
      command:
      - /usr/local/bin/runner.sh
      - /bin/bash
      - -ce
      env:
      - name: GIT_AUTHOR_NAME
        value: kubevirt-bot
      - name: GIT_AUTHOR_EMAIL
        value: kubevirtbot@redhat.com
      - name: GIT_REPO_URL
        value: https://kubevirt-bot@github.com/kubevirt/sig-release.git
      image: quay.io/kubevirtci/golang:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 200Mi
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 30 0,7 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 3h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-monitoring
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-monitoring
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 2,6,14,22 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.32-sig-network
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.32-sig-network
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 1,6,14,22 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-ipv6-sig-network
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-network
      - name: KUBEVIRT_SINGLE_STACK
        value: "true"
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 29Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 20 2,5,13,21 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.32-sig-storage
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.32-sig-storage
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 30 0,4,8,16 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.32-sig-compute
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.32-sig-compute
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --usb 30M --usb 40M
      - name: KUBEVIRT_FUNC_TEST_GINKGO_TIMEOUT
        value: 4h45m
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 40 1,5,9,17 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.32-sig-operator
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.32-sig-operator
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 2,7,15,23 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.33-sig-network
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.33-sig-network
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 30 3,6,14,22 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.33-sig-storage
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.33-sig-storage
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 40 1,4,9,17 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.33-sig-compute
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.33-sig-compute
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --usb 30M --usb 40M
      - name: KUBEVIRT_FUNC_TEST_GINKGO_TIMEOUT
        value: 4h45m
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 2,5,10,18 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.33-sig-operator
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.33-sig-operator
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 0,3,8,16 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-network
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-network
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 40 2,7,15,23 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-storage
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-storage
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 2,6,10,18 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-compute
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-compute
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --usb 30M --usb 40M
      - name: KUBEVIRT_FUNC_TEST_GINKGO_TIMEOUT
        value: 4h45m
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 3,7,11,19 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-operator
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.34-sig-operator
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 20 1,7,13,19 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.35-sig-network
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.35-sig-network
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 3,9,15,21 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.35-sig-storage
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.35-sig-storage
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 0 3,9,15,21 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.35-sig-compute
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.35-sig-compute
      - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
        value: --usb 30M --usb 40M
      - name: KUBEVIRT_FUNC_TEST_GINKGO_TIMEOUT
        value: 4h45m
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 10 4,10,16,22 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.35-sig-operator
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - automation/test.sh
      env:
      - name: KUBEVIRT_E2E_RUN_ALL_SUITES
        value: "true"
      - name: KUBEVIRT_QUARANTINE
        value: "true"
      - name: TARGET
        value: k8s-1.35-sig-operator
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 52Gi
      securityContext:
        privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: kubevirt-prow-control-plane
  cron: 30 4,12,20,00 * * *
  max_concurrency: 1
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
  - base_ref: main
    org: kubevirt
    repo: kubevirt
  - base_ref: main
    org: kubevirt
    repo: project-infra
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-quay-credential: "true"
    preset-podman-in-container-enabled: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-test-secure-execution-s390x
  spec:
    containers:
    - command:
      - /usr/local/bin/runner.sh
      - /bin/sh
      - -c
      - |
        # get kubeconfig
        source ../project-infra/hack/manage-secrets.sh
        decrypt_secrets
        extract_secret 'kubeconfigS390xSecureExecution' /kubeconfig

        # login quay.io
        cat "$QUAY_PASSWORD" | docker login --username $(cat "$QUAY_USER") --password-stdin=true quay.io

        # run the test
        automation/test.sh
      env:
      - name: TARGET
        value: external-secure-execution
      - name: KUBEVIRT_PROVIDER
        value: external
      - name: DOCKER_PREFIX
        value: quay.io/kubevirtci
      - name: DOCKER_TAG
        value: s390x_se_test
      - name: KUBECONFIG
        value: /kubeconfig
      - name: IMAGE_PULL_POLICY
        value: Always
      - name: BUILD_ARCH
        value: amd64,crossbuild-s390x
      - name: GIT_ASKPASS
        value: ../project-infra/hack/git-askpass.sh
      image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
      name: ""
      resources:
        requests:
          memory: 8Gi
      securityContext:
        privileged: true
      volumeMounts:
      - mountPath: /etc/github
        name: token
      - mountPath: /etc/pgp
        name: pgp-bot-key
        readOnly: true
    volumes:
    - name: token
      secret:
        secretName: oauth-token
    - name: pgp-bot-key
      secret:
        secretName: pgp-bot-key
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 5,17 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
    - base_ref: main
      org: kubevirt
      repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-compute-migrations-np
  spec:
    containers:
      - command:
          - /usr/local/bin/runner.sh
          - /bin/sh
          - -c
          - automation/test.sh
        env:
          - name: KUBEVIRT_DEPLOY_NP
            value: "true"
          - name: TARGET
            value: k8s-1.34-sig-compute-migrations
        image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
        name: ""
        resources:
          requests:
            memory: 52Gi
        securityContext:
          privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 6,18 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 5h0m0s
  extra_refs:
    - base_ref: main
      org: kubevirt
      repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-compute-np
  spec:
    containers:
      - command:
          - /usr/local/bin/runner.sh
          - /bin/sh
          - -c
          - automation/test.sh
        env:
          - name: KUBEVIRT_DEPLOY_NP
            value: "true"
          - name: TARGET
            value: k8s-1.34-sig-compute
          - name: KUBEVIRT_PROVIDER_EXTRA_ARGS
            value: --usb 30M --usb 40M
          - name: KUBEVIRT_FUNC_TEST_GINKGO_TIMEOUT
            value: 4h45m
        image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
        name: ""
        resources:
          requests:
            memory: 52Gi
        securityContext:
          privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 7,19 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
    - base_ref: main
      org: kubevirt
      repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-network-np
  spec:
    containers:
      - command:
          - /usr/local/bin/runner.sh
          - /bin/sh
          - -c
          - automation/test.sh
        env:
          - name: KUBEVIRT_DEPLOY_NP
            value: "true"
          - name: TARGET
            value: k8s-1.34-sig-network
        image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
        name: ""
        resources:
          requests:
            memory: 52Gi
        securityContext:
          privileged: true
    nodeSelector:
      type: bare-metal-external
- annotations:
    testgrid-dashboards: kubevirt-periodics
    testgrid-days-of-results: "60"
  cluster: prow-workloads
  cron: 50 8,20 * * *
  decorate: true
  decoration_config:
    grace_period: 5m0s
    timeout: 4h0m0s
  extra_refs:
    - base_ref: main
      org: kubevirt
      repo: kubevirt
  labels:
    preset-bazel-cache: "true"
    preset-docker-mirror-proxy: "true"
    preset-kubevirtci-etcd-in-mem: "true"
    preset-podman-in-container-enabled: "true"
    preset-podman-shared-images: "true"
    preset-shared-images: "true"
  name: periodic-kubevirt-e2e-k8s-1.34-sig-storage-np
  spec:
    containers:
      - command:
          - /usr/local/bin/runner.sh
          - /bin/sh
          - -c
          - automation/test.sh
        env:
          - name: KUBEVIRT_DEPLOY_NP
            value: "true"
          - name: TARGET
            value: k8s-1.34-sig-storage
        image: quay.io/kubevirtci/bootstrap:v20251022-6eb3ab1
        name: ""
        resources:
          requests:
            memory: 52Gi
        securityContext:
          privileged: true
    nodeSelector:
      type: bare-metal-external
